extends layout
block content
	style.
		.icon-img {
			max-width: 30px;
			width: 100%;
		}
	- var sub_cate = [];
	each key in Object.keys(data.category_obj)
		if(data.category_obj[key].length > 0)
			- var sub_list = data.category_obj[key]
			each cate_item in sub_list
				- sub_cate.push(cate_item);
	.container
		.bg-gradient-zhupao
			a(href='/')
				img(src='/assets/images/pegasus_logo.jpg', alt='logo', style='width:250px;')
		.w-100.bg-gradient-primary.mb-3
			h5.m-0.text-white.p-2
				a.text-white(href='/') Home
				| &nbsp; > &nbsp;
				a.text-white(href='/list/' + cate_info[0].group_id + '/' + Object.keys(sub_cate[0])) #{cate_info[0].group_name}
				| &nbsp; > &nbsp; #{sub_cate[0][Object.keys(sub_cate[0])]}
		.row
			.col-8.text-zhupao
				h4.font-weight-bold #{data.data_title}
				h5.text-right 단위 : #{data.data_unit}
				.card
					.card-body.shadow
						canvas#chart(width='100%', height='50')
				h6.text-right.text-zhupao.mt-3 Data No. #{data.data_no}
			.col-4.font-weight-bold
				.d-flex.mb-2
					span.px-3.py-2(style='flex:1; border-bottom:4px solid #007bff') DOWNLOAD
					div.border-bottom(style='flex:2')
				.d-flex
					.border
						button.btn.d-flex.justify-content-between.p-2
							img.icon-img(src='/assets/svgs/png.svg')
							span PNG
					.border.ml-2
						button.btn.d-flex.justify-content-between.p-2
							img.icon-img(src='/assets/svgs/ppt.svg')
							span PNG
					.border.ml-2
						button.btn.d-flex.justify-content-between.p-2
							img.icon-img(src='/assets/svgs/xls.svg')
							span PNG
					.border.ml-2
						button.btn.d-flex.justify-content-between.p-2
							img.icon-img(src='/assets/svgs/pdf.svg')
							span PNG
				ul#pills-tab.nav.nav-pills.mt-4.mb-3.pb-2.border-bottom(role="tablist")
					li.nav-item
						a#pills-home-tab.nav-link.active.rounded-0.border.border-primary.py-1(data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true") DESCRIPTION
					li.nav-item
						a#pills-profile-tab.nav-link.rounded-0.border.border-primary.ml-1.py-1(data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false") SOURCE
				#pills-tabContent.tab-content
					#pills-home.tab-pane.fade.show.active(role="tabpanel" aria-labelledby="pills-home-tab") #{data.description}
					#pills-profile.tab-pane.fade(role="tabpanel" aria-labelledby="pills-profile-tab") #{data.source}

block append_js
	script(src='/bootstrap/js/dist/util.js', type='text/javascript')
	script(src='/chart.js/Chart.js')
	script.
		let d = !{JSON.stringify(data)};
		console.log(d);
		// 차트 색 설정
		let bg_list = [
			'rgba(255, 99, 132, 0.4)', 'rgba(54, 162, 235, 0.4)', 'rgba(255, 206, 86, 0.4)', 'rgba(75, 192, 192, 0.4)', 'rgba(153, 102, 255, 0.4)', 'rgba(255, 159, 64, 0.4)'
		];
		// 차트 타입
		let chart_type = '';
		switch (d.chart_type) {
			case 'bar_chart_vertical':
				chart_type = 'bar';
				break;
			case 'bar_chart_horizontal':
				chart_type = 'horizontalBar';
				break;
			case 'pie_chart':
				chart_type = 'pie';
				break;
			case 'line_chart':
				chart_type = 'line';
				break;
		}
		let x_title = d.table_x.title;
		let barChartData = {};
		barChartData.labels = d.table_x.content;
		barChartData.datasets = [];
		d.table_y.forEach(function(row, idx){
			let obj = {};
			obj.label = row.title;
			obj.data = row.content;
			obj.backgroundColor = bg_list[idx%6];
			barChartData.datasets.push(obj);
		});
		//

		let ctx = document.getElementById('chart');
		let chart = new Chart(ctx, {
			type: chart_type,
			data:barChartData,
			options: {
				scales: {
					xAxes:[{stacked:true}],
					yAxes: [{
						ticks: {beginAtZero: true},
						stacked:true
					}]
				}
			}
		});